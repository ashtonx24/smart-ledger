<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Smart Ledger</title>
  </head>
  <body>
    <h1>Smart Ledger Frontend</h1>

    <!-- Button to load data -->
    <button id="load-data">Load Data</button>
    <table id="data-table" border="1" cellpadding="8">
      <thead>
        <tr>
          <th>ID</th>
          <th>User ID</th>
          <th>Amount</th>
          <th>Status</th>
          <th>Order Date</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- New form to add orders -->
    <h2>Add New Order</h2>
    <form id="order-form">
      <input name="user_id" placeholder="User ID" type="number" required />
      <input name="amount" placeholder="Amount" type="number" required />
      <input name="status" placeholder="Status" required />
      <input name="order_date" type="date" required />
      <button type="submit">Add Order</button>
    </form>

    <script>
      // Load data from backend
      document
        .getElementById("load-data")
        .addEventListener("click", async () => {
          const res = await fetch("/data");
          const json = await res.json();
          const tbody = document.querySelector("#data-table tbody");
          tbody.innerHTML = ""; // Clear any existing rows

          json.data.forEach((order) => {
            const row = document.createElement("tr");
            row.innerHTML = `
        <td>${order.id}</td>
        <td>${order.user_id}</td>
        <td>${order.amount}</td>
        <td>${order.status}</td>
        <td>${order.order_date}</td>
      `;
            tbody.appendChild(row);
          });
        });

      // Submit new order to backend
      document
        .getElementById("order-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);
          const payload = Object.fromEntries(formData.entries());

          await fetch("/add-order", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          e.target.reset(); // Clear the form
          document.getElementById("load-data").click(); // Reload data
        });
    </script>
  </body>
</html>
